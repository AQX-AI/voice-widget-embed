(()=>{const e=document.getElementById("talkButton"),t=document.getElementById("status"),o=document.getElementById("localAudio");let a,n,r;e.addEventListener("click",(async function(){if(console.log("Initiating conversation"),window.apiKey){try{const e=await fetch("https://aqx-ai-call-server-dtdwhtb8fcb7g8b0.eastus-01.azurewebsites.net/web");console.log(e)}catch(e){console.error(e)}try{a=new(window.AudioContext||window.webkitAudioContext);const e=await navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{n=new MediaRecorder(e,{mimeType:"audio/webm"})}));o.srcObject=e,t.textContent="Connecting...",r=new WebSocket("wss://aqx-ai-call-server-dtdwhtb8fcb7g8b0.eastus-01.azurewebsites.net/"),n.ondataavailable=async e=>{if(e.data.size>0&&r.readyState===WebSocket.OPEN){const t=await e.data.arrayBuffer(),o=btoa(String.fromCharCode(...new Uint8Array(t))),a=JSON.stringify({event:"media",based:"web",media:{payload:o}});r.send(a)}},r.onopen=()=>{t.textContent="Connected. Please start talking..."},r.onmessage=async e=>{const t=JSON.parse(e.data);if("media"===t.event&&t.media.payload){const e=t.media.payload,o=window.atob(e),n=o.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=o.charCodeAt(e);const i=r.buffer,c=await a.decodeAudioData(i),s=a.createBufferSource();s.buffer=c,s.connect(a.destination),s.start()}},r.onerror=e=>{console.error("WebSocket error:",e),t.textContent="WebSocket error"},r.onclose=()=>{t.textContent="Connection closed"},n.start(250)}catch(e){!function(e){let t="An error occurred while accessing media devices.";switch(e.name){case"NotAllowedError":t="Permission to access the microphone was denied.";break;case"NotFoundError":t="No microphone was found.";break;case"NotReadableError":t="The microphone is already in use by another application.";break;case"OverconstrainedError":t="The constraints specified are not supported by any available microphone.";break;case"AbortError":t="The operation was aborted.";break;default:t=`An unknown error occurred: ${e.message}`}alert(t),console.error(t,e)}(e)}}else alert("API key not found")}))})();